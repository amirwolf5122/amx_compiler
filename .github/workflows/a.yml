name: amxx

on: workflow_dispatch

jobs:
  linux:
    name: Linux
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
      - name: RUN..
        run: |
          cd scripting
          chmod +x *
          ./compile.sh
          ls -l compiled  # نمایش فایل‌های موجود در دایرکتوری compiled
          zip -r compiled.zip compiled/*
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: linux-build
          path: compiled.zip
  release:
    name: Release
    runs-on: ubuntu-latest
    needs: [linux]
    steps:
      - name: Fetch artifacts
        uses: actions/download-artifact@v4
      - name: Remove old release
        uses: ClementTsang/delete-tag-and-release@v0.3.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: continuous
          delete_release: true
          repo: ${{ env.GITHUB_REPOSITORY }}
      - name: Prepare release
        run: |
          ls
          sleep 60s
      - name: Purge artifacts
        uses: geekyeggo/delete-artifact@v2
        with:
          name: "*"
      - name: Upload new release
        uses: svenstaro/upload-release-action@v2
        with:
          repo_name: ${{ env.GITHUB_REPOSITORY }}
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file_glob: true
          file: CS16Client-*
          tag: continuous
          overwrite: true
          prerelease: true
          release_name: CS16Client development build
